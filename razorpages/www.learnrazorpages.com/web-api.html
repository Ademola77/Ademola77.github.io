<!DOCTYPE html>
<html>

<!-- Mirrored from www.learnrazorpages.com/web-api by HTTrack Website Copier/3.x [XR&CO'2005], Fri, 07 Jun 2019 04:18:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="The recommended approach to providing data services that work with JSON in ASP.NET Razor Pages is to use the Web API framework." />
    <meta name="google-site-verification" content="MpV6gEoCh9OASgnoi656klwnlkni3_qOenITGlxBrjc" />
    <title>Working with JSON in Razor Pages | Learn Razor Pages</title>
    <link rel="canonical" href="web-api.html" />
    <link rel="stylesheet" href="../ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i|Roboto:300i,500,700" />
    <link rel="stylesheet" href="../use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="../cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <link rel="stylesheet" href="css/site8249.css?v=PCA7f9VuZUscxMwrePJfyFKXCF9mh2dMpXEDQU8oP3o" />
    <link rel="stylesheet" href="css/rp14c5.css?v=ZxkVB0StHjR5-UMElJII7nwWe6Wmc6_qgJ97GsY4yNw" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "ca-pub-8046723421340367",
                enable_page_level_ads: true
            });
        </script>
</head>
<body id="page-top">
    <div class="navbar navbar-default navbar-static-top">
        <div>
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-brand">
                    <i class="fas fa-graduation-cap"></i> <a href="index.html">Learn Razor Pages</a>
                    <br />
                    <span class="byline">Your guide to using ASP.NET Core Razor Pages</span>
                </div>
                <div class="banner">
                    
                        <script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
                        <!-- EF Core Leaderboard -->
                        <ins class="adsbygoogle"
                             style="display:inline-block;width:728px;height:90px"
                             data-ad-client="ca-pub-8046723421340367"
                             data-ad-slot="1832525889"></ins>
                        <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>                    
                </div>
            </div>

        </div>
    </div>
    <div class="navbar-default sidebar" role="navigation">
        <div class="sidebar-nav navbar-collapse">
            <nav class="main-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <ul class="nav nav-level-one" id="side-menu">
        <li>
            <a itemprop="url" href="index.html">Home</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="first-look.html">A First Look</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="asp-net-core.html">ASP.NET Core</a>
        </li>
        <li><a itemprop="url" href="razor-pages/tutorial/bakery.html">Tutorials</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="razor-pages/tutorial/bakery.html">The Bakery</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="razor-pages.html">Razor Page Files</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="razor-pages/files/index.html">Razor Files</a></li>
                <li><a itemprop="url" href="razor-pages/partial-pages.html">Partial Pages</a></li>
                <li><a itemprop="url" href="razor-pages/files/layout.html">Layout Files</a></li>
                <li><a itemprop="url" href="razor-pages/files/viewimports.html">ViewImports File</a></li>
                <li><a itemprop="url" href="razor-pages/files/viewstart.html">ViewStart File</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="razor-syntax.html">Razor Syntax</a>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/pagemodel.html">Page Models</a>
            <ul class="nav-level-two">
                <li>
                    <a itemprop="url" href="razor-pages/handler-methods.html">Handler Methods</a>
                </li>
                <li>
                    <a itemprop="url" href="razor-pages/viewdata.html">ViewData</a>
                </li>
                <li>
                    <a itemprop="url" href="razor-pages/action-results.html">Action Results</a>
                </li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/tag-helpers/index.html">Tag Helpers</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="razor-pages/tag-helpers/anchor-tag-helper.html">Anchor Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/cache-tag-helper.html">Cache Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/distributed-cache-tag-helper.html">Distributed Cache Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/environment-tag-helper.html">Environment Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/form-action-tag-helper.html">Form Action Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/form-tag-helper.html">Form Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/image-tag-helper.html">Image Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/input-tag-helper.html">Input Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/label-tag-helper.html">Label Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/link-tag-helper.html">Link Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/option-tag-helper.html">Option Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/partial-tag-helper.html">Partial Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/script-tag-helper.html">Script Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/select-tag-helper.html">Select Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/textarea-tag-helper.html">TextArea Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/validation-message-tag-helper.html">Validation Message Tag Helper</a></li>
                <li><a itemprop="url" href="razor-pages/tag-helpers/validation-summary-tag-helper.html">Validation Summary Tag Helper</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/view-components.html">View Components</a>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/routing.html">Routing and URLs</a>
            <ul class="nav-level-two">
                <li><a href="advanced/custom-route-conventions.html">Customising Route Conventions</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="startup.html">Startup</a>
        </li>
        <li>
            <a itemprop="url" href="configuration.html">Configuration</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="configuration/global-error-handling.html">Global Error Handling And Logging</a></li>
                <li><a itemprop="url" href="configuration/custom-errors.html">Custom Error Pages</a></li>
                <li><a itemprop="url" href="configuration/https.html">Configuring HTTPS</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="middleware.html">Middleware</a>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/forms.html">Working With Forms</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="razor-pages/forms/file-upload.html">Uploading Files in Razor Pages</a></li>
                <li><a itemprop="url" href="razor-pages/forms/checkboxes.html">Working With Checkboxes</a></li>
                <li><a itemprop="url" href="razor-pages/forms/select-lists.html">Select Lists in a Razor Pages Form</a></li>
                <li><a itemprop="url" href="razor-pages/forms/radios.html">Working With Radio Buttons</a></li>
                <li><a itemprop="url" href="security/request-verification.html">Request Verification</a></li>
            </ul>
        </li>
        <li><a itemprop="url" href="razor-pages/validation.html">Validation</a></li>
        <li>
            <a itemprop="url" href="razor-pages/model-binding.html">Model Binding</a>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/state-management.html">State Management</a>
        </li>
        <li>
            <a itemprop="url" href="razor-pages/caching.html">Caching</a>
        </li>
        <li>
            <a itemprop="url" href="identity.html">Managing Security With ASP.NET Identity</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="identity/customising-identity.html">Customising Identity</a></li>
            </ul>
        </li>
        <li>
		<a itemprop="url" href="razor-pages/ajax.html">Using AJAX</a>
		<ul class="nav-level-two">
			<li><a itemprop="url" href="razor-pages/ajax/form-post.html">Posting Forms</a>    </li>
			<li><a itemprop="url" href="razor-pages/ajax/partial-update.html">Partial Page Updates</a></li>
			<li><a itemprop="url" href="razor-pages/ajax/upload-files.html">Uploading Files</a></li>
			<li><a itemprop="url" href="razor-pages/ajax/unobtrusive-ajax.html">Unobtrusive AJAX</a></li>
		</ul>
	</li>
        <li>
            <a itemprop="url" href="web-api.html">Working with JSON</a>
        </li>
        <li>
            <a itemprop="url" href="miscellaneous/scaffolding.html">Scaffolding</a>
        </li>
        <li>
            <a itemprop="url" href="publishing/publish-to-iis.html">Publishing To IIS</a>
        </li>
        <li>
            <a itemprop="url" href="advanced.html">Advanced</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="advanced/areas.html">Areas</a></li>
                <li><a itemprop="url" href="advanced/custom-tag-helpers.html">Custom Tag Helpers</a></li>
                <li><a itemprop="url" href="advanced/custom-route-conventions.html">Customising Route Conventions</a></li>
                <li><a itemprop="url" href="advanced/custom-constraints.html">Custom Route Constraints</a></li>
                <li><a itemprop="url" href="advanced/route-parameter-transformers.html">Parameter Transformers For Routes</a></li>
                <li><a itemprop="url" href="advanced/dependency-injection.html">Dependency Injection</a></li>
                <li><a itemprop="url" href="razor-pages/filters.html">Filters</a></li>
                <li><a itemprop="url" href="advanced/razor-class-library.html">Razor Class Libraries</a></li>
                <li><a itemprop="url" href="advanced/render-partial-to-string.html">Rendering A Partial View To A String</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="table-of-contents.html">Table Of Contents</a>
        </li>
    </ul>
</nav>

            <footer>
                <p>&copy; 2019 - Learn Razor Pages.<br />All rights reserved.</p>
            </footer>
        </div>
        <!-- /.sidebar-collapse -->
    </div>

    <div id="page-wrapper">
        <div class="body-content">
            <div class="row">
                <div class="col-md-9">
                    
<div id="article">
    <h1 itemprop="headline" id="working-with-json-in-razor-pages">Working with JSON in Razor Pages</h1>
<div itemprop="articleBody"><p>UI generation and processing within web applications is moving increasingly to the client. Data processing and storage is undertaken on the server, with JSON being the preferred format for exchanging data between the server and the client. The recommended approach to providing data services that work with JSON in ASP.NET Core is to use the Web API framework.</p>
<h2 id="web-api">Web API</h2>
<p>Web API is a framework for building HTTP-based services. Typically, that means making data available as a service via the HTTP protocol. Services built using Web API conform to the <a href="http://en.wikipedia.org/wiki/Representational_state_transfer"><strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer (REST) architectural pattern</a>. An important element of this is that the service should respond appropriately based on the HTTP verb that was used to make the request (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code> etc.). Different verbs are used by the client making the request to express the intent behind the operation. They map to CRUD operations as follows:</p>
<table class="table">
<thead>
<tr>
<th style="text-align: left;">HTTP Verb</th>
<th style="text-align: left;">CRUD Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>POST</code></td>
<td style="text-align: left;">Create</td>
</tr>
<tr>
<td style="text-align: left;"><code>GET</code></td>
<td style="text-align: left;">Read</td>
</tr>
<tr>
<td style="text-align: left;"><code>PUT</code></td>
<td style="text-align: left;">Update</td>
</tr>
<tr>
<td style="text-align: left;"><code>DELETE</code></td>
<td style="text-align: left;">Delete</td>
</tr>
</tbody>
</table>
<p>Web API controllers are available to a Razor Pages application without any additional configuration, and the default data format that they work with is JSON.</p>
<h2 id="an-example-application">An example application</h2>
<p>The following walkthrough illustrates how to integrate Web API into a Razor Pages application to provide CRUD services. The application itself is a single page CRUD application. The subject matter is cars. The application uses jQuery on the client for managing the UI, and an in-memory cache to store the cars. Both choices were made with simplicity in mind for demonstration purposes.</p>
<ol>
<li><p>Create a new Razor Pages application using the CLI commands (<code>dotnet new razor</code>) or using the Visual Studio New Project dialog. Name the project <em>RazorAPI</em> if you plan to copy and paste code from here and don't want issues with conflicting namespaces occurring.</p>
</li>
<li><p>Add a folder named <em>Models</em> and add a new C# Class file to it named <em>Car.cs</em>. Replace any existing content with the following:</p>
<pre><code class="language-csharp">namespace RazorAPI.Models
{
    public class Car
    {
        public int Id { get; set; }
        public string Make { get; set; }
        public string Model { get; set; }
        public int Year { get; set; }
        public int Doors { get; set; }
        public string Colour { get; set; }
        public decimal Price { get; set; }
    }
}
</code></pre>
</li>
<li><p>Add a new folder named <em>Services</em> and add a new C# class file to it named <em>CarService.cs</em>. Replace any existing content with the following:</p>
<pre><code class="language-csharp">using Microsoft.Extensions.Caching.Memory;
using RazorAPI.Models;
using System.Collections.Generic;
using System.Linq;

namespace RazorAPI.Services
{
    public interface ICarService
    {
        List&lt;Car&gt; ReadAll();
        void Create(Car car);
        Car Read(int id);
        void Update(Car modofiedCar);
        void Delete(int id);
    }

    public class CarService : ICarService
    {
        private readonly IMemoryCache _cache;

        public CarService(IMemoryCache cache)
        {
            _cache = cache;
        }

        public List&lt;Car&gt; ReadAll()
        {
            if (_cache.Get(&quot;CarList&quot;) == null)
            {
                List&lt;Car&gt; cars = new List&lt;Car&gt;{
                new Car{Id = 1, Make=&quot;Audi&quot;,Model=&quot;R8&quot;,Year=2014,Doors=2,Colour=&quot;Red&quot;,Price=79995},
                new Car{Id = 2, Make=&quot;Aston Martin&quot;,Model=&quot;Rapide&quot;,Year=2010,Doors=2,Colour=&quot;Black&quot;,Price=54995},
                new Car{Id = 3, Make=&quot;Porsche&quot;,Model=&quot; 911 991&quot;,Year=2016,Doors=2,Colour=&quot;White&quot;,Price=155000},
                new Car{Id = 4, Make=&quot;Mercedes-Benz&quot;,Model=&quot;GLE 63S&quot;,Year=2017,Doors=5,Colour=&quot;Blue&quot;,Price=83995},
                new Car{Id = 5, Make=&quot;BMW&quot;,Model=&quot;X6 M&quot;,Year=2016,Doors=5,Colour=&quot;Silver&quot;,Price=62995},
            };
                _cache.Set(&quot;CarList&quot;, cars);
            }
            return _cache.Get&lt;List&lt;Car&gt;&gt;(&quot;CarList&quot;);
        }

        public void Create(Car car)
        {
            var cars = ReadAll();
            car.Id = cars.Max(c =&gt; c.Id) + 1;
            cars.Add(car);
            _cache.Set(&quot;CarList&quot;, cars);
        }

        public Car Read(int id)
        {
            return ReadAll().Single(c =&gt; c.Id == id);
        }

        public void Update(Car modifiedCar)
        {
            var cars = ReadAll();
            var car = cars.Single(c =&gt; c.Id == modifiedCar.Id);
            car.Make = modifiedCar.Make;
            car.Model = modifiedCar.Model;
            car.Doors = modifiedCar.Doors;
            car.Colour = modifiedCar.Colour;
            car.Year = modifiedCar.Year;
            _cache.Set(&quot;CarList&quot;, cars);
        }

        public void Delete(int id)
        {
            var cars = ReadAll();
            var deletedCar = cars.Single(c =&gt; c.Id == id);
            cars.Remove(deletedCar);
            _cache.Set(&quot;CarList&quot;, cars);
        }
    }
}
</code></pre>
<p>This represents a simple CRUD service for the <code>Car</code> entity defined in the Model. All it does is to store a list of <code>Car</code> entities in memory, and provide some methods for accessing one or all of the entries, and for adding, editing and deleting <code>Car</code> entities. It also exposes an interface that needs to be registered with the dependency injection system.</p>
</li>
<li><p>Open <em>Startup.cs</em> and amend the <code>ConfigureServices</code> method so that it looks like the following:</p>
<pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    services.AddMemoryCache();
    services.AddTransient&lt;ICarService, CarService&gt;();
}
</code></pre>
<p>You will also need to add <code>using RazorAPI.Services</code> to the <code>using</code> directives at the top of the file to bring the <code>CarService</code> into scope.</p>
<p>The <code>CarService</code> is registered with the DI system along with the default memory cache component.</p>
</li>
<li><p>Change the existing <em>Pages.Index.cshtml.cs</em> file content to the following:</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc.RazorPages;

namespace RazorAPI.Pages
{
    public class IndexModel : PageModel
    {
        public int Id { get; set; }
        public string Make { get; set; }
        public string Model { get; set; }
        public int Year { get; set; }
        public string Colour { get; set; }
        public int Doors { get; set; }
        public int Price { get; set; }
    }
}
</code></pre>
<p>These properties have been added so that <a href="razor-pages/tag-helpers.html">tag helpers</a> can be used for form fields in the UI. Usually, you would decorate properties that are used for form fields with the <code>[BindProperty]</code> attribute, but the form in question will not be posted normally and Razor Pages <a href="razor-pages/model-binding.html">model binding</a> is not required.</p>
</li>
<li><p>Adjust the _<em>Layout.cshtml</em> file to remove the navigation:</p>
<pre><code class="language-html">&lt;nav class=&quot;navbar navbar-inverse navbar-fixed-top&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;navbar-header&quot;&gt;
            &lt;a asp-page=&quot;/Index&quot; class=&quot;navbar-brand&quot;&gt;RazorAPI&lt;/a&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/nav&gt;
&lt;div class=&quot;container body-content&quot;&gt;
    @RenderBody()
    &lt;hr /&gt;
    &lt;footer&gt;
        &lt;p&gt;&amp;copy; 2017 - RazorAPI&lt;/p&gt;
    &lt;/footer&gt;
&lt;/div&gt;
</code></pre>
<p>You can also take this opportunity to delete the Contact and About pages and their PageModel class files.</p>
</li>
<li><p>Add the following to the content of the <em>Index.cshtml</em> file:</p>
<pre><code class="language-html">&lt;div class=&quot;row&quot; id=&quot;content&quot;&gt;
    &lt;div class=&quot;col-lg-6&quot;&gt;
        &lt;h3&gt;All Cars&lt;/h3&gt;
        &lt;ul id=&quot;car-list&quot;&gt;&lt;/ul&gt;
        &lt;button class=&quot;btn btn-sm btn-default&quot; id=&quot;new&quot;&gt;Add New&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-lg-6&quot;&gt;
        &lt;div id=&quot;details&quot;&gt;&lt;/div&gt;
        &lt;div id=&quot;form&quot;&gt;
            &lt;form class=&quot;form-horizontal&quot;&gt;
                &lt;input type=&quot;hidden&quot; asp-for=&quot;Id&quot; /&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label for=&quot;Model&quot;&gt;Make&lt;/label&gt;
                    &lt;input type=&quot;text&quot; asp-for=&quot;Make&quot; class=&quot;form-control input-sm&quot; /&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label for=&quot;Model&quot;&gt;Model&lt;/label&gt;
                    &lt;input type=&quot;text&quot; asp-for=&quot;Model&quot; class=&quot;form-control input-sm&quot; /&gt;
                &lt;/div&gt;

                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label for=&quot;Colour&quot;&gt;Colour&lt;/label&gt;
                    &lt;input type=&quot;text&quot; asp-for=&quot;Colour&quot; class=&quot;form-control input-sm&quot; /&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label for=&quot;Year&quot;&gt;Year&lt;/label&gt;
                    &lt;input type=&quot;number&quot; asp-for=&quot;Year&quot; class=&quot;form-control input-sm&quot; /&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label for=&quot;Doors&quot;&gt;Doors&lt;/label&gt;
                    &lt;input type=&quot;number&quot; asp-for=&quot;Doors&quot; class=&quot;form-control input-sm&quot; /&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label for=&quot;Price&quot;&gt;Price&lt;/label&gt;
                    &lt;input type=&quot;number&quot; asp-for=&quot;Price&quot; class=&quot;form-control input-sm&quot; /&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;button class=&quot;btn btn-primary btn-sm&quot; id=&quot;save&quot;&gt;Submit&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>The markup includes an area where a list of cars will be displayed, another where details of a selected car are shown, and a form for adding and editing cars. The method (<code>POST</code>, <code>GET</code>, <code>PUT</code> etc) of the form is not specified. This will be determined at runtime by client side code.</p>
</li>
<li><p>Add the following declarations to the <em>site.css</em> file:</p>
<pre><code class="language-css">input{
    max-width:280px;
}

.entry {
    min-width: 250px;
    display: inline-block;
}

.details, .edit, .delete {
    cursor: pointer;
    color: #337ab7;
    text-decoration: underline;
}

ul{
    padding-left:0;
    list-style-type: none;
}

#content{
    min-height:500px;
}
</code></pre>
</li>
<li><p>Add a new folder called <em>Controllers</em> and then use the <strong>Add</strong> context menu option in Visual Studio to add a Web API controller with Read/Write actions and name it <em>CarController.cs</em>:</p>
<p><img src="images/17-05-2018-07-51-17.png" class="img-fluid" alt="Image" /></p>
<p>This will auto-generate a class with the following attributes:</p>
<pre><code class="language-csharp">[Produces(&quot;application/json&quot;)]
[Route(&quot;api/Car&quot;)]
public class CarController : Controller
{
    ...
</code></pre>
<p>The <code>Produces</code> attribute specifies the content type of the data that the controller actions generate. The default is JSON. The <code>Route</code> attribute specifies the route for the controller. Individual actions are selected using a combination of the HTTP verb used for the request and any parameters.</p>
<p>The next step is to replace the default actions that return strings to ones that call methods in the <code>CarService</code>.</p>
</li>
<li><p>Replace the existing controller code with the following:</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc;
using RazorAPI.Models;
using RazorAPI.Services;
using System.Collections.Generic;

namespace RazorAPI.Controllers
{
    [Produces(&quot;application/json&quot;)]
    [Route(&quot;api/Car&quot;)]
    public class CarController : Controller
    {
        private readonly ICarService _carService;

        public CarController(ICarService carService)
        {
            _carService = carService;
        }

        // GET: api/Car
        [HttpGet]
        public IEnumerable&lt;Car&gt; Get()
        {
            return _carService.ReadAll();
        }

        // GET: api/Car/5
        [HttpGet(&quot;{id}&quot;, Name = &quot;Get&quot;)]
        public Car Get(int id)
        {
            return _carService.Read(id);
        }

        // POST: api/Car
        [HttpPost]
        public void Post([FromBody]Car car)
        {
            _carService.Create(car);
        }

        // PUT: api/Car/5
        [HttpPut(&quot;{id}&quot;)]
        public void Put(int id, [FromBody]Car car)
        {
            _carService.Update(car);
        }

        // DELETE: api/ApiWithActions/5
        [HttpDelete(&quot;{id}&quot;)]
        public void Delete(int id)
        {
            _carService.Delete(id);
        }
    }
}
</code></pre>
<p>The controller exposes 5 methods: <code>Get</code> with no parameters, returning all cars; <code>Get</code> with an integer as a parameter, returning the car with an <code>Id</code> value matching the one passed as a parameter; <code>Post</code> taking values from the body of the request to construct a new <code>Car</code> entity; <code>Put</code> which is used to modify the car  identified by the <code>id</code> parameter with the values passed in the request body; and <code>Delete</code> which deletes the car having the <code>Id</code> passed as a parameter.</p>
<p>The <code>CarService</code> that actually manages these operations is passed in to the controller via constructor injection.</p>
</li>
<li><p>Finally, the client side code. Add the following to the end of the <em>Index.cshtml</em> file:</p>
<pre><code class="language-js">@section scripts{
&lt;script type=&quot;text/javascript&quot;&gt;
    $(function () {
        var loadCars = function () {
            $('#car-list').empty();
            $.get('/api/car').done(function (cars) {
                $.each(cars, function (i, car) {
                    var item = `&lt;li&gt;
                            &lt;span class=&quot;entry&quot;&gt;
                                &lt;strong&gt;${car.make} ${car.model}&lt;/strong&gt;
                                (£${car.price})
                                &lt;/span&gt;
                                &lt;span class =&quot;details&quot; data-id=&quot;${car.id}&quot;&gt;Details&lt;/span&gt; |
                                &lt;span class =&quot;edit&quot;  data-id=&quot;${car.id}&quot;&gt;Edit&lt;/span&gt; |
                                &lt;span class =&quot;delete&quot;  data-id=&quot;${car.id}&quot;&gt;Delete&lt;/span&gt;
                            &lt;/li&gt;`;
                    $('#car-list').append(item);
                });
            });
        }

        var showForm = function () {
            $(':input').val('');
            $('#details').empty();
            $('#form').show();
        }

        var clearForm = function () {
            $('#details').empty();
            $(':input').val('');
            $('#form').hide();
        }

        $('#new').on('click', showForm);

        clearForm();
        loadCars();

        $('#car-list').on('click', '.edit, .details', function () {
            var cmd = $(this);
            $.get(`/api/car/${cmd.data('id')}`).done(function (car) {
                if (cmd.hasClass('details')) {
                    clearForm()
                    $('#details').empty().append(
                        `&lt;h3&gt;Details&lt;/h3&gt;
                    &lt;strong&gt;${car.make} ${car.model}&lt;/strong&gt;&lt;br&gt;
                    £${car.price}&lt;br&gt;
                    Doors: ${car.doors}&lt;br&gt;
                    Year: ${car.year}&lt;br&gt;
                    Colour: ${car.colour}`
                    );
                } else {
                    showForm();
                    $('#Id').val(car.id);
                    $('#Make').val(car.make);
                    $('#Model').val(car.model);
                    $('#Colour').val(car.colour);
                    $('#Year').val(car.year);
                    $('#Doors').val(car.doors);
                    $('#Price').val(car.price);
                }
            });
        });

        $('#save').on('click', function (e) {
            e.preventDefault();

            var url = '/api/car/';
            var method = 'post';
            if ($('#Id').val() !== '') {
                url += $('#Id').val();
                method = 'put';
            }
            var car = {};
            $.each($(this).closest('form').serializeArray(), function () {
                if (this.name !== 'Id' || (this.name === 'Id' &amp;&amp; this.value !== '')) {
                    car[this.name] = this.value || '';
                }
            });

            $.ajax({
                type: method,
                url: url,
                data: JSON.stringify(car),
                contentType: 'application/json'
            }).done(function () {
                clearForm();
                loadCars();
            });
        });

        $('#car-list').on('click', '.delete', function () {
            $.ajax({
                type: 'delete',
                url: '/api/car/' + $(this).data('id'),
            }).done(function () {
                clearForm();
                loadCars();
            });
        });
    });
&lt;/script&gt;
}
</code></pre>
<p>The first section of the code declares a function called <code>loadCars</code>. This function clears the <code>ul</code> that has an id of  <code>car-list</code> of any content and then calls the API using the <code>GET</code> verb with no parameters which maps to the method that returns a list of all cars. The HTML for  the list items is built up using the jQuery <code>each</code> function to iterate the collection of cars returned by the API.</p>
<div class="alert alert-warning"><p>This example uses <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">Template literals</a> (similar to C# 7.0 string interpolation) to build the HTML. Note that this is not supported in Internet Explorer 11. If you plan to support IE11, you can use standard string concatenation or a transpiler like <a href="https://babeljs.io/">Babel</a>.</p>
</div>
<p>Notice that the JSON version of the property names on the car object use camel casing (start with lower case). This is the default behaviour when serialising to JSON in .NET Core. In previous versions of ASP.NET, the default was Pascal casing. You can restore this option through configuration:</p>
<pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc()
        .AddJsonOptions(options =&gt; options.SerializerSettings.ContractResolver = new DefaultContractResolver());
}
</code></pre>
<p>The resulting HTML consists of a series of list items that include links to show details of the entry, edit it or delete it.</p>
<p>Next, two convenience functions are defined that show and hide the form so that it is ready for use and doesn't retain information from previous operations. The <strong>Add New</strong> button is wired up to show the form when it is clicked. Then the functions to clear the form and hide it, and to populate the list are called, resulting in the following content in the page:</p>
<p><img src="images/17-05-2018-09-23-20.png" class="img-fluid" alt="Image" /></p>
<p>The <strong>Edit</strong> and <strong>Details</strong> links have click handlers attached to them that fire a <code>GET</code> request appended with the <code>Id</code> of the car that they apply to which returns the specified car entity. If the link that was clicked is a details link (determined by the CSS class applied to it), the details of the car are displayed, otherwise they are presented in the form for editing.</p>
<p>When the form is submitted, the hidden <code>Id</code> field is inspected. If it was populated as a result of the <strong>Edit</strong> link being clicked, the HTTP method is set to <code>PUT</code> and the <code>Id</code> of the car to be modified is appended to the URL, mapping this request to the <code>[HttpPut(&quot;{id}&quot;)]</code> Web API route. If it is empty, this is a new car and the method is set to <code>POST</code>.</p>
<p>In both cases, the content of the form fields is serialised into a Javascript object:</p>
<pre><code class="language-js">var car = {};
$.each($(this).closest('form').serializeArray(), function () {
    if (this.name !== 'Id' || (this.name === 'Id' &amp;&amp; this.value !== '')) {
        car[this.name] = this.value || '';
    }
});
</code></pre>
<p>The <code>Id</code> property is only included in the serialised object if it has a value.</p>
<p>The content type is specified for the request as <code>application/json</code>. Failure to do this will result in an HTTP 415 - Unsupported Media Type error code because the content type of the request will default to <code>application/x-www-form-urlencoded</code>:</p>
<p><img src="images/18-05-2018-07-57-14.png" class="img-fluid" alt="Image" /></p>
<p>If you actually want to support <code>application/x-www-form-urlencoded</code>, you need to change the Web API method to use the <code>[FromForm]</code> attribute instead of the <code>[FromBody]</code> attribute. When the <code>FromBody</code> option is specified, the framework uses a JSON Input Formatter which expects to find a JSON string in the body of the request:</p>
<p><img src="images/17-05-2018-15-23-46.png" class="img-fluid" alt="Image" /></p>
<p>The final block of code takes care of deleting car objects. It adds the <code>Id</code> of the car to be deleted to the URL and then uses the <code>DELETE</code> method:</p>
<p><img src="images/17-05-2018-15-37-41.png" class="img-fluid" alt="Image" /></p>
</li>
</ol>

</div>
</div>
<section id="file-meta">
    <span class="file-meta-label">Last updated:</span> <span itemprop="dateModified">18/05/2018 08:27:59</span><br />
</section>

                </div>
                <div class="col-md-3 right-col">
                    
                            <script>
                        (function() {
                            var cx = 'partner-pub-8046723421340367:6108194070';
                            var gcse = document.createElement('script');
                            gcse.type = 'text/javascript';
                            gcse.async = true;
                            gcse.src = '../cse.google.com/cse07b6.html?cx=' + cx;
                            var s = document.getElementsByTagName('script')[0];
                            s.parentNode.insertBefore(gcse, s);
                        })();
                            </script>
                        <gcse:searchbox-only></gcse:searchbox-only>
                    
                    <div id="doc-outline" class="doc-outline well">
                            <h3 class="doc-outline">On this page</h3>
                            <nav class="doc-outline">
                                <ul>
                                        <li><a itemprop="url" href="#working-with-json-in-razor-pages" class="page-scroll">Working with JSON in Razor Pages</a></li>
                                        <li><a itemprop="url" href="#web-api" class="page-scroll">Web API</a></li>
                                        <li><a itemprop="url" href="#an-example-application" class="page-scroll">An example application</a></li>
                                </ul>
                            </nav>

                    </div>
                    <div class="rectangle">
                        
                                <script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
                            <!-- EF Core Rectangle -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:300px;height:250px"
                                 data-ad-client="ca-pub-8046723421340367"
                                 data-ad-slot="7622896857"></ins>
                            <script>
                                (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        
                    </div>
                    <div class="doc-outline well">
                        <h3 class="doc-outline">Latest Updates</h3>
                        <nav class="doc-outline">
                            <ul>
                                    <li><a itemprop="url" href="razor-pages/tutorial/bakery/migration.html">Creating A Migration</a></li>
                                    <li><a itemprop="url" href="razor-pages/tutorial/bakery/create-model.html">Working With A Model</a></li>
                                    <li><a itemprop="url" href="razor-pages/routing.html">Routing in Razor Pages</a></li>
                                    <li><a itemprop="url" href="razor-pages/tutorial/bakery/working-with-data.html">Working With Data</a></li>
                                    <li><a itemprop="url" href="razor-pages/tutorial/bakery/new-page.html">Adding a New Page</a></li>
                                    <li><a itemprop="url" href="razor-pages/tutorial/bakery.html">Creating an Application</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="skyscraper">
                        
                                <script async src="../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
                            <!-- EF Core Skyscraper -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:300px;height:600px"
                                 data-ad-client="ca-pub-8046723421340367"
                                 data-ad-slot="4239197376"></ins>
                            <script>
                                (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        
                    </div>
                    <footer>
                        <p>&copy; 2019 - Learn Razor Pages.<br />All rights reserved.</p>
                    </footer>
                </div>
            </div>
        </div>
        <a href="#page-top" id="back-to-top" class="page-scroll" title="Back to top"><i class="fas fa-arrow-alt-circle-up"></i></a>
    </div>
    <div class="cookie-box" id="cookie-warning">
        <div class="cookie-box-contents" id="learnrazorpages">This site uses cookies to analyse traffic, remember your preferences, and optimise your experience.</div>
        <div class="cookie-box-buttons"><a href="privacy.html" class="cookie-button">Learn more</a><a href="#" class="cookie-button" id="cookie-close">Close</a></div>
    </div>
    <script src="../ajax.aspnetcdn.com/ajax/jquery/jquery-2.2.0.min.js"></script>
    <script src="../ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/bootstrap.min.js"></script>
    <script src="../code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    
    <script src="../cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <script src="js/site59f2.js?v=gJZRD7PDF8oEm1Xb0uhLZcpf7Vs12fGO-q0DErBSF_Y"></script>
    
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1264020-21"></script>
        <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-1264020-21');
        </script>
    
    
</body>

<!-- Mirrored from www.learnrazorpages.com/web-api by HTTrack Website Copier/3.x [XR&CO'2005], Fri, 07 Jun 2019 04:18:43 GMT -->
</html>
