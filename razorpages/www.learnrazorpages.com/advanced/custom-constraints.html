<!DOCTYPE html>
<html>

<!-- Mirrored from www.learnrazorpages.com/advanced/custom-constraints by HTTrack Website Copier/3.x [XR&CO'2005], Fri, 07 Jun 2019 04:19:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="google-site-verification" content="MpV6gEoCh9OASgnoi656klwnlkni3_qOenITGlxBrjc" />
    <title>Creating Custom Constraints For Razor Pages Routes | Learn Razor Pages</title>
    <link rel="canonical" href="custom-constraints.html" />
    <link rel="stylesheet" href="../../ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i|Roboto:300i,500,700" />
    <link rel="stylesheet" href="../../use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="../../cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <link rel="stylesheet" href="../css/site8249.css?v=PCA7f9VuZUscxMwrePJfyFKXCF9mh2dMpXEDQU8oP3o" />
    <link rel="stylesheet" href="../css/rp14c5.css?v=ZxkVB0StHjR5-UMElJII7nwWe6Wmc6_qgJ97GsY4yNw" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "ca-pub-8046723421340367",
                enable_page_level_ads: true
            });
        </script>
</head>
<body id="page-top">
    <div class="navbar navbar-default navbar-static-top">
        <div>
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <div class="navbar-brand">
                    <i class="fas fa-graduation-cap"></i> <a href="../index.html">Learn Razor Pages</a>
                    <br />
                    <span class="byline">Your guide to using ASP.NET Core Razor Pages</span>
                </div>
                <div class="banner">
                    
                        <script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
                        <!-- EF Core Leaderboard -->
                        <ins class="adsbygoogle"
                             style="display:inline-block;width:728px;height:90px"
                             data-ad-client="ca-pub-8046723421340367"
                             data-ad-slot="1832525889"></ins>
                        <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>                    
                </div>
            </div>

        </div>
    </div>
    <div class="navbar-default sidebar" role="navigation">
        <div class="sidebar-nav navbar-collapse">
            <nav class="main-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
    <ul class="nav nav-level-one" id="side-menu">
        <li>
            <a itemprop="url" href="../index.html">Home</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../first-look.html">A First Look</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../asp-net-core.html">ASP.NET Core</a>
        </li>
        <li><a itemprop="url" href="../razor-pages/tutorial/bakery.html">Tutorials</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../razor-pages/tutorial/bakery.html">The Bakery</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages.html">Razor Page Files</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../razor-pages/files/index.html">Razor Files</a></li>
                <li><a itemprop="url" href="../razor-pages/partial-pages.html">Partial Pages</a></li>
                <li><a itemprop="url" href="../razor-pages/files/layout.html">Layout Files</a></li>
                <li><a itemprop="url" href="../razor-pages/files/viewimports.html">ViewImports File</a></li>
                <li><a itemprop="url" href="../razor-pages/files/viewstart.html">ViewStart File</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../razor-syntax.html">Razor Syntax</a>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/pagemodel.html">Page Models</a>
            <ul class="nav-level-two">
                <li>
                    <a itemprop="url" href="../razor-pages/handler-methods.html">Handler Methods</a>
                </li>
                <li>
                    <a itemprop="url" href="../razor-pages/viewdata.html">ViewData</a>
                </li>
                <li>
                    <a itemprop="url" href="../razor-pages/action-results.html">Action Results</a>
                </li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/tag-helpers/index.html">Tag Helpers</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../razor-pages/tag-helpers/anchor-tag-helper.html">Anchor Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/cache-tag-helper.html">Cache Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/distributed-cache-tag-helper.html">Distributed Cache Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/environment-tag-helper.html">Environment Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/form-action-tag-helper.html">Form Action Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/form-tag-helper.html">Form Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/image-tag-helper.html">Image Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/input-tag-helper.html">Input Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/label-tag-helper.html">Label Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/link-tag-helper.html">Link Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/option-tag-helper.html">Option Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/partial-tag-helper.html">Partial Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/script-tag-helper.html">Script Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/select-tag-helper.html">Select Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/textarea-tag-helper.html">TextArea Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/validation-message-tag-helper.html">Validation Message Tag Helper</a></li>
                <li><a itemprop="url" href="../razor-pages/tag-helpers/validation-summary-tag-helper.html">Validation Summary Tag Helper</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/view-components.html">View Components</a>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/routing.html">Routing and URLs</a>
            <ul class="nav-level-two">
                <li><a href="custom-route-conventions.html">Customising Route Conventions</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../startup.html">Startup</a>
        </li>
        <li>
            <a itemprop="url" href="../configuration.html">Configuration</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../configuration/global-error-handling.html">Global Error Handling And Logging</a></li>
                <li><a itemprop="url" href="../configuration/custom-errors.html">Custom Error Pages</a></li>
                <li><a itemprop="url" href="../configuration/https.html">Configuring HTTPS</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../middleware.html">Middleware</a>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/forms.html">Working With Forms</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../razor-pages/forms/file-upload.html">Uploading Files in Razor Pages</a></li>
                <li><a itemprop="url" href="../razor-pages/forms/checkboxes.html">Working With Checkboxes</a></li>
                <li><a itemprop="url" href="../razor-pages/forms/select-lists.html">Select Lists in a Razor Pages Form</a></li>
                <li><a itemprop="url" href="../razor-pages/forms/radios.html">Working With Radio Buttons</a></li>
                <li><a itemprop="url" href="../security/request-verification.html">Request Verification</a></li>
            </ul>
        </li>
        <li><a itemprop="url" href="../razor-pages/validation.html">Validation</a></li>
        <li>
            <a itemprop="url" href="../razor-pages/model-binding.html">Model Binding</a>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/state-management.html">State Management</a>
        </li>
        <li>
            <a itemprop="url" href="../razor-pages/caching.html">Caching</a>
        </li>
        <li>
            <a itemprop="url" href="../identity.html">Managing Security With ASP.NET Identity</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="../identity/customising-identity.html">Customising Identity</a></li>
            </ul>
        </li>
        <li>
		<a itemprop="url" href="../razor-pages/ajax.html">Using AJAX</a>
		<ul class="nav-level-two">
			<li><a itemprop="url" href="../razor-pages/ajax/form-post.html">Posting Forms</a>    </li>
			<li><a itemprop="url" href="../razor-pages/ajax/partial-update.html">Partial Page Updates</a></li>
			<li><a itemprop="url" href="../razor-pages/ajax/upload-files.html">Uploading Files</a></li>
			<li><a itemprop="url" href="../razor-pages/ajax/unobtrusive-ajax.html">Unobtrusive AJAX</a></li>
		</ul>
	</li>
        <li>
            <a itemprop="url" href="../web-api.html">Working with JSON</a>
        </li>
        <li>
            <a itemprop="url" href="../miscellaneous/scaffolding.html">Scaffolding</a>
        </li>
        <li>
            <a itemprop="url" href="../publishing/publish-to-iis.html">Publishing To IIS</a>
        </li>
        <li>
            <a itemprop="url" href="../advanced.html">Advanced</a>
            <ul class="nav-level-two">
                <li><a itemprop="url" href="areas.html">Areas</a></li>
                <li><a itemprop="url" href="custom-tag-helpers.html">Custom Tag Helpers</a></li>
                <li><a itemprop="url" href="custom-route-conventions.html">Customising Route Conventions</a></li>
                <li><a itemprop="url" href="custom-constraints.html">Custom Route Constraints</a></li>
                <li><a itemprop="url" href="route-parameter-transformers.html">Parameter Transformers For Routes</a></li>
                <li><a itemprop="url" href="dependency-injection.html">Dependency Injection</a></li>
                <li><a itemprop="url" href="../razor-pages/filters.html">Filters</a></li>
                <li><a itemprop="url" href="razor-class-library.html">Razor Class Libraries</a></li>
                <li><a itemprop="url" href="render-partial-to-string.html">Rendering A Partial View To A String</a></li>
            </ul>
        </li>
        <li>
            <a itemprop="url" href="../table-of-contents.html">Table Of Contents</a>
        </li>
    </ul>
</nav>

            <footer>
                <p>&copy; 2019 - Learn Razor Pages.<br />All rights reserved.</p>
            </footer>
        </div>
        <!-- /.sidebar-collapse -->
    </div>

    <div id="page-wrapper">
        <div class="body-content">
            <div class="row">
                <div class="col-md-9">
                    
<div id="article">
    <h1 itemprop="headline" id="creating-custom-constraints-for-razor-pages-routes">Creating Custom Constraints For Razor Pages Routes</h1>
<div itemprop="articleBody"><p>Razor Page already includes a <a href="../miscellaneous/constraints.html">wide range of constraints</a> that can be used to help disambiguate routes. It is also possible for you to create your own custom constraint and then register that with the routing system.</p>
<p>Imagine that you have a page that is designed to show the details of a product. Following convention, you create a page named <em>Details.cshtml</em> in a folder named <em>Product</em> within the <em>Pages</em> folder. You want visitors to reach the page using the URL <code>domain.com/product/details/{productname}</code> where the <code>{productname}</code> is the actual name of a specific product (suitably slugified). So you add a route template accordingly:</p>
<pre><code class="language-csharp">@page &quot;{productname}&quot;
</code></pre>
<p>Now you can retrieve the RouteData value for <code>productname</code>, and use it to perform a database query. This works fine, but what you soon begin to realise is that sometimes, the database query doesn't return a result. When you review your logs, you see that the value being passed to the database query is not what you expect to see in your URLs. It might be part of the product name, or it might have some extra characters added, or indeed it might bear no resemblance to anything in your database at all. There are countless ways in which links to your site can get broken when they are being shared, or stored by a poorly written bot.</p>
<p>What you really could do with is some way to prevent the wasted processing that these database look-ups for non-existent values incur, and also inform the requester that the page they are looking for doesn't exist. You want to return a 404 HTTP status code.</p>
<p>The solution can be implemented as a custom constraint. Then the routing system will take care of ensuring that the user gets the correct response.</p>
<h2 id="an-example-look-up-service">An Example Look-up Service</h2>
<p>The constraint will work by matching incoming route values to existing product names. The product names need to obtained from the database. Obviously you don't want to do this for every request - that would defeat the object of the exercise. So you will use <a href="../razor-pages/caching.html">caching</a> as part of your strategy. For the purposes of demonstration, however, the service will just return a List<string></p>
<pre><code class="language-csharp">public interface IProductService
{
    List&lt;string&gt; GetProductNames();
}

public class ProductService : IProductService
{
    public List&lt;string&gt; GetProductNames()
    {
        return new List&lt;string&gt;
        {
            &quot;chai&quot;,
            &quot;chang&quot;,
            &quot;aniseed-syrup&quot;,
            &quot;chef-antons-cajun-seasoning&quot;,
            &quot;chef-antons-gumbo-mix&quot;,
            &quot;grandmas-boysenberry-spread&quot;,
            &quot;uncle-bobs-organic-dried-pears&quot;,
            &quot;northwoods-cranberry-sauce&quot;,
            &quot;mishi-kobe-niku&quot;
        };
    }
}
</code></pre>
<p>The service conforms to an interface, which is registered with the <a href="dependency-injection.html">dependency injection</a> system:</p>
<pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
    ...
    services.AddTransient&lt;IProductService, ProductService&gt;();
}
</code></pre>
<h2 id="the-constraint">The Constraint</h2>
<p>Constraints implement the <code>IRouteConstraint</code> interface, which defines one method: <code>Match</code>. This is where the logic that determines whether a value satisfies the constraint is placed. The method returns a <code>bool</code> indicating success:</p>
<pre><code class="language-csharp">public class ProductConstraint : IRouteConstraint
{
    private readonly IProductService productService;

    public ProductConstraint(IProductService productService)
    {
        this.productService = productService;
    }

    public bool Match(HttpContext httpContext, IRouter route, string routeKey, RouteValueDictionary values, RouteDirection routeDirection)
    {
        var productNames = productService.GetProductNames();
        return productNames.Contains(values[routeKey]?.ToString().ToLowerInvariant());
    }
}
</code></pre>
<p>In this example, the <code>ProductService</code> is injected into the constructor. The <code>Match</code> method returns <code>true</code> if there is an entry in the <code>RouteValueDictionary</code> with the specified key that matches any in the database.</p>
<h3 id="registering-and-using-the-constraint">Registering And Using The Constraint</h3>
<p>The constraint needs to be registered with the routing system. This is done in the <code>ConfigureServices</code> method in Startup:</p>
<pre><code class="language-csharp">services.Configure&lt;RouteOptions&gt;(options =&gt;
{
    options.ConstraintMap.Add(&quot;product&quot;, typeof(ProductConstraint));
});
</code></pre>
<p>The entry added to the RoutOption.ConstraintMap consists of a <code>string</code> as the key and a <code>Type</code> as the value. The key is used to to identify the constraint when you apply it to a route value parameter:</p>
<pre><code class="language-html">@page &quot;{productname:product}&quot;
</code></pre>
<p>A valid value in the URL will result in a successful request:</p>
<p><img src="../images/01-04-2019-08-17-59.png" class="img-fluid" alt="Image" /></p>
<p>Whereas if you request the Details page without passing in an existing value, the framework returns a 404:</p>
<p><img src="../images/01-04-2019-08-16-26.png" class="img-fluid" alt="Image" /></p>

</div>
</div>
<section id="file-meta">
    <span class="file-meta-label">Last updated:</span> <span itemprop="dateModified">01/04/2019 08:21:19</span><br />
</section>

                </div>
                <div class="col-md-3 right-col">
                    
                            <script>
                        (function() {
                            var cx = 'partner-pub-8046723421340367:6108194070';
                            var gcse = document.createElement('script');
                            gcse.type = 'text/javascript';
                            gcse.async = true;
                            gcse.src = '../../cse.google.com/cse07b6.html?cx=' + cx;
                            var s = document.getElementsByTagName('script')[0];
                            s.parentNode.insertBefore(gcse, s);
                        })();
                            </script>
                        <gcse:searchbox-only></gcse:searchbox-only>
                    
                    <div id="doc-outline" class="doc-outline well">
                            <h3 class="doc-outline">On this page</h3>
                            <nav class="doc-outline">
                                <ul>
                                        <li><a itemprop="url" href="#creating-custom-constraints-for-razor-pages-routes" class="page-scroll">Creating Custom Constraints For Razor Pages Routes</a></li>
                                        <li><a itemprop="url" href="#an-example-look-up-service" class="page-scroll">An Example Look-up Service</a></li>
                                        <li><a itemprop="url" href="#the-constraint" class="page-scroll">The Constraint</a></li>
                                        <li><a itemprop="url" href="#registering-and-using-the-constraint" class="page-scroll">Registering And Using The Constraint</a></li>
                                </ul>
                            </nav>

                    </div>
                    <div class="rectangle">
                        
                                <script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
                            <!-- EF Core Rectangle -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:300px;height:250px"
                                 data-ad-client="ca-pub-8046723421340367"
                                 data-ad-slot="7622896857"></ins>
                            <script>
                                (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        
                    </div>
                    <div class="doc-outline well">
                        <h3 class="doc-outline">Latest Updates</h3>
                        <nav class="doc-outline">
                            <ul>
                                    <li><a itemprop="url" href="../razor-pages/tutorial/bakery/migration.html">Creating A Migration</a></li>
                                    <li><a itemprop="url" href="../razor-pages/tutorial/bakery/create-model.html">Working With A Model</a></li>
                                    <li><a itemprop="url" href="../razor-pages/routing.html">Routing in Razor Pages</a></li>
                                    <li><a itemprop="url" href="../razor-pages/tutorial/bakery/working-with-data.html">Working With Data</a></li>
                                    <li><a itemprop="url" href="../razor-pages/tutorial/bakery/new-page.html">Adding a New Page</a></li>
                                    <li><a itemprop="url" href="../razor-pages/tutorial/bakery.html">Creating an Application</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="skyscraper">
                        
                                <script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
                            <!-- EF Core Skyscraper -->
                            <ins class="adsbygoogle"
                                 style="display:inline-block;width:300px;height:600px"
                                 data-ad-client="ca-pub-8046723421340367"
                                 data-ad-slot="4239197376"></ins>
                            <script>
                                (adsbygoogle = window.adsbygoogle || []).push({});
                            </script>
                        
                    </div>
                    <footer>
                        <p>&copy; 2019 - Learn Razor Pages.<br />All rights reserved.</p>
                    </footer>
                </div>
            </div>
        </div>
        <a href="#page-top" id="back-to-top" class="page-scroll" title="Back to top"><i class="fas fa-arrow-alt-circle-up"></i></a>
    </div>
    <div class="cookie-box" id="cookie-warning">
        <div class="cookie-box-contents" id="learnrazorpages">This site uses cookies to analyse traffic, remember your preferences, and optimise your experience.</div>
        <div class="cookie-box-buttons"><a href="../privacy.html" class="cookie-button">Learn more</a><a href="#" class="cookie-button" id="cookie-close">Close</a></div>
    </div>
    <script src="../../ajax.aspnetcdn.com/ajax/jquery/jquery-2.2.0.min.js"></script>
    <script src="../../ajax.aspnetcdn.com/ajax/bootstrap/3.3.6/bootstrap.min.js"></script>
    <script src="../../code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    
    <script src="../../cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <script src="../js/site59f2.js?v=gJZRD7PDF8oEm1Xb0uhLZcpf7Vs12fGO-q0DErBSF_Y"></script>
    
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1264020-21"></script>
        <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-1264020-21');
        </script>
    
    
</body>

<!-- Mirrored from www.learnrazorpages.com/advanced/custom-constraints by HTTrack Website Copier/3.x [XR&CO'2005], Fri, 07 Jun 2019 04:19:39 GMT -->
</html>
